<div class="modal-backdrop">
  <div class="modal">
    <header class="modal__header">
      <h2>{{ title }}</h2>
      <button type="button" mat-icon-button (click)="close.emit()">
        <mat-icon>close</mat-icon>
      </button>
    </header>
    <form class="form" [formGroup]="form" (ngSubmit)="submit()">
      <div class="row">
        <mat-form-field appearance="outline">
          <mat-label>Name</mat-label>
          <input matInput type="text" formControlName="name" />
          <mat-hint align="end">Required</mat-hint>
          <mat-error *ngIf="form.controls.name.touched && form.controls.name.errors?.['required']"
            >Name is required</mat-error
          >
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="outline">
          <mat-label>Description</mat-label>
          <textarea matInput rows="3" formControlName="description"></textarea>
        </mat-form-field>
      </div>

      <div class="row grid-2">
        <mat-form-field appearance="outline">
          <mat-label>Price</mat-label>
          <input matInput type="number" step="0.01" formControlName="price" />
          <mat-error *ngIf="form.controls.price.touched && form.controls.price.errors"
            >Price must be greater than 0</mat-error
          >
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Stock</mat-label>
          <input matInput type="number" formControlName="stock" />
          <mat-error *ngIf="form.controls.stock.touched && form.controls.stock.errors"
            >Stock can't be negative</mat-error
          >
        </mat-form-field>
      </div>

      <div class="row grid-2">
        <mat-form-field appearance="outline">
          <mat-label>Category</mat-label>
          <input matInput type="text" formControlName="category" />
        </mat-form-field>

        <div class="file-input">
          <label for="photos" class="file-label">Upload image(s)</label>
          <input
            id="photos"
            type="file"
            multiple
            accept="image/*"
            (change)="onFilesSelected($event)"
          />
          <div class="file-hint" *ngIf="selectedFiles && selectedFiles.length">
            {{ selectedFiles.length }} file(s) selected
          </div>
        </div>
      </div>

      @if (error()) {
      <p class="error">{{ error() }}</p>
      }

      <footer class="actions">
        <button type="button" mat-stroked-button (click)="close.emit()">Cancel</button>
        <button
          type="submit"
          mat-flat-button
          color="primary"
          [disabled]="submitting() || form.invalid"
        >
          {{ submitting() ? (product ? 'Saving…' : 'Creating…') : product ? 'Save' : 'Create' }}
        </button>
      </footer>
    </form>
  </div>
</div>
